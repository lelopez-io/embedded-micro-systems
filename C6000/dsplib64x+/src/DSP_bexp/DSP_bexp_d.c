/* ======================================================================= */
/* DSP_bexp_d.c -- Block exponent of a vector                              */
/*                 Driver code implementation                              */
/*                                                                         */
/* Rev 0.0.1                                                               */
/*                                                                         */
/* ----------------------------------------------------------------------- */
/*            Copyright (c) 2007 Texas Instruments, Incorporated.          */
/*                           All Rights Reserved.                          */
/* ======================================================================= */

#include <stdio.h>
#include <time.h>
#include <stdlib.h>
#include <limits.h>

/* ======================================================================= */
/* Interface header files for the natural C and optimized C code           */
/* ======================================================================= */
#include "DSP_bexp.h"
#include "DSP_bexp_cn.h"

/* ======================================================================= */
/* Inform the compiler the arrays are double word alligned                 */
/* ======================================================================= */
#pragma DATA_ALIGN(x, 8);

/* ======================================================================= */
/* Parameters of fixed dataset                                             */
/* ======================================================================= */
#define N (512)
#define PAD (16)

/* ======================================================================= */
/* Initilized arrays with fixed test data                                  */
/* ======================================================================= */
const int x[N + 2*PAD] =
{
     0x00000000,  0x00000000,  0x00000000,  0x00000000, // Beginning Pad
     0x00000000,  0x00000000,  0x00000000,  0x00000000, // Beginning Pad
     0x00000000,  0x00000000,  0x00000000,  0x00000000, // Beginning Pad
     0x00000000,  0x00000000,  0x00000000,  0x00000000, // Beginning Pad

     0x00000001,  0x00000002,  0x00000004,  0x00000006,
     0x00000010,  0x00000020,  0x00000040,  0x00000060,
     0x00000100,  0x00000200,  0x00000400,  0x00000600,
     0x00001000,  0x00002000,  0x00004000,  0x00006000,
     0x00010000,  0x00020000,  0x00040000,  0x00060000,
     0x00100000,  0x00200000,  0x00400000,  0x00600000,
     0x01000000,  0x02000000,  0x04000000,  0x06000000,
     0x10000000,  0x20000000,  0x40000000,  0x60000000,
    -0x00000001, -0x00000002, -0x00000004, -0x00000006,
    -0x00000010, -0x00000020, -0x00000040, -0x00000060,
    -0x00000100, -0x00000200, -0x00000400, -0x00000600,
    -0x00001000, -0x00002000, -0x00004000, -0x00006000,
    -0x00010000, -0x00020000, -0x00040000, -0x00060000,
    -0x00100000, -0x00200000, -0x00400000, -0x00600000,
    -0x01000000, -0x02000000, -0x04000000, -0x06000000,
    -0x10000000, -0x20000000, -0x40000000, -0x60000000,
     0x00000008,  0x0000000A,  0x0000000C,  0x0000000E,
     0x00000080,  0x000000A0,  0x000000C0,  0x000000E0,
     0x00000800,  0x00000A00,  0x00000C00,  0x00000E00,
     0x00008000,  0x0000A000,  0x0000C000,  0x0000E000,
     0x00080000,  0x000A0000,  0x000C0000,  0x000E0000,
     0x00800000,  0x00A00000,  0x00C00000,  0x00E00000,
     0x08000000,  0x0A000000,  0x0C000000,  0x0E000000,
     0x80000000,  0xA0000000,  0xC0000000,  0xE0000000,
    -0x00000008, -0x0000000A, -0x0000000D, -0x0000000E,
    -0x00000080, -0x000000A0, -0x000000D0, -0x000000E0,
    -0x00000800, -0x00000A00, -0x00000D00, -0x00000E00,
    -0x00008000, -0x0000A000, -0x0000D000, -0x0000E000,
    -0x00080000, -0x000A0000, -0x000D0000, -0x000E0000,
    -0x00800000, -0x00A00000, -0x00D00000, -0x00E00000,
    -0x08000000, -0x0A000000, -0x0D000000, -0x0E000000,
    -0x80000000, -0xA0000000, -0xD0000000, -0xE0000000,
     0x00000001,  0x00000002,  0x00000004,  0x00000006,
     0x00000010,  0x00000020,  0x00000040,  0x00000060,
     0x00000100,  0x00000200,  0x00000400,  0x00000600,
     0x00001000,  0x00002000,  0x00004000,  0x00006000,
     0x00010000,  0x00020000,  0x00040000,  0x00060000,
     0x00100000,  0x00200000,  0x00400000,  0x00600000,
     0x01000000,  0x02000000,  0x04000000,  0x06000000,
     0x10000000,  0x20000000,  0x40000000,  0x60000000,
    -0x00000001, -0x00000002, -0x00000004, -0x00000006,
    -0x00000010, -0x00000020, -0x00000040, -0x00000060,
    -0x00000100, -0x00000200, -0x00000400, -0x00000600,
    -0x00001000, -0x00002000, -0x00004000, -0x00006000,
    -0x00010000, -0x00020000, -0x00040000, -0x00060000,
    -0x00100000, -0x00200000, -0x00400000, -0x00600000,
    -0x01000000, -0x02000000, -0x04000000, -0x06000000,
    -0x10000000, -0x20000000, -0x40000000, -0x60000000,
     0x00000008,  0x0000000A,  0x0000000C,  0x0000000E,
     0x00000080,  0x000000A0,  0x000000C0,  0x000000E0,
     0x00000800,  0x00000A00,  0x00000C00,  0x00000E00,
     0x00008000,  0x0000A000,  0x0000C000,  0x0000E000,
     0x00080000,  0x000A0000,  0x000C0000,  0x000E0000,
     0x00800000,  0x00A00000,  0x00C00000,  0x00E00000,
     0x08000000,  0x0A000000,  0x0C000000,  0x0E000000,
     0x80000000,  0xA0000000,  0xC0000000,  0xE0000000,
    -0x00000008, -0x0000000A, -0x0000000D, -0x0000000E,
    -0x00000080, -0x000000A0, -0x000000D0, -0x000000E0,
    -0x00000800, -0x00000A00, -0x00000D00, -0x00000E00,
    -0x00008000, -0x0000A000, -0x0000D000, -0x0000E000,
    -0x00080000, -0x000A0000, -0x000D0000, -0x000E0000,
    -0x00800000, -0x00A00000, -0x00D00000, -0x00E00000,
    -0x08000000, -0x0A000000, -0x0D000000, -0x0E000000,
    -0x80000000, -0xA0000000, -0xD0000000, -0xE0000000,
     0x00000001,  0x00000002,  0x00000004,  0x00000006,
     0x00000010,  0x00000020,  0x00000040,  0x00000060,
     0x00000100,  0x00000200,  0x00000400,  0x00000600,
     0x00001000,  0x00002000,  0x00004000,  0x00006000,
     0x00010000,  0x00020000,  0x00040000,  0x00060000,
     0x00100000,  0x00200000,  0x00400000,  0x00600000,
     0x01000000,  0x02000000,  0x04000000,  0x06000000,
     0x10000000,  0x20000000,  0x40000000,  0x60000000,
    -0x00000001, -0x00000002, -0x00000004, -0x00000006,
    -0x00000010, -0x00000020, -0x00000040, -0x00000060,
    -0x00000100, -0x00000200, -0x00000400, -0x00000600,
    -0x00001000, -0x00002000, -0x00004000, -0x00006000,
    -0x00010000, -0x00020000, -0x00040000, -0x00060000,
    -0x00100000, -0x00200000, -0x00400000, -0x00600000,
    -0x01000000, -0x02000000, -0x04000000, -0x06000000,
    -0x10000000, -0x20000000, -0x40000000, -0x60000000,
     0x00000008,  0x0000000A,  0x0000000C,  0x0000000E,
     0x00000080,  0x000000A0,  0x000000C0,  0x000000E0,
     0x00000800,  0x00000A00,  0x00000C00,  0x00000E00,
     0x00008000,  0x0000A000,  0x0000C000,  0x0000E000,
     0x00080000,  0x000A0000,  0x000C0000,  0x000E0000,
     0x00800000,  0x00A00000,  0x00C00000,  0x00E00000,
     0x08000000,  0x0A000000,  0x0C000000,  0x0E000000,
     0x80000000,  0xA0000000,  0xC0000000,  0xE0000000,
    -0x00000008, -0x0000000A, -0x0000000D, -0x0000000E,
    -0x00000080, -0x000000A0, -0x000000D0, -0x000000E0,
    -0x00000800, -0x00000A00, -0x00000D00, -0x00000E00,
    -0x00008000, -0x0000A000, -0x0000D000, -0x0000E000,
    -0x00080000, -0x000A0000, -0x000D0000, -0x000E0000,
    -0x00800000, -0x00A00000, -0x00D00000, -0x00E00000,
    -0x08000000, -0x0A000000, -0x0D000000, -0x0E000000,
    -0x80000000, -0xA0000000, -0xD0000000, -0xE0000000,
     0x00000001,  0x00000002,  0x00000004,  0x00000006,
     0x00000010,  0x00000020,  0x00000040,  0x00000060,
     0x00000100,  0x00000200,  0x00000400,  0x00000600,
     0x00001000,  0x00002000,  0x00004000,  0x00006000,
     0x00010000,  0x00020000,  0x00040000,  0x00060000,
     0x00100000,  0x00200000,  0x00400000,  0x00600000,
     0x01000000,  0x02000000,  0x04000000,  0x06000000,
     0x10000000,  0x20000000,  0x40000000,  0x60000000,
    -0x00000001, -0x00000002, -0x00000004, -0x00000006,
    -0x00000010, -0x00000020, -0x00000040, -0x00000060,
    -0x00000100, -0x00000200, -0x00000400, -0x00000600,
    -0x00001000, -0x00002000, -0x00004000, -0x00006000,
    -0x00010000, -0x00020000, -0x00040000, -0x00060000,
    -0x00100000, -0x00200000, -0x00400000, -0x00600000,
    -0x01000000, -0x02000000, -0x04000000, -0x06000000,
    -0x10000000, -0x20000000, -0x40000000, -0x60000000,
     0x00000008,  0x0000000A,  0x0000000C,  0x0000000E,
     0x00000080,  0x000000A0,  0x000000C0,  0x000000E0,
     0x00000800,  0x00000A00,  0x00000C00,  0x00000E00,
     0x00008000,  0x0000A000,  0x0000C000,  0x0000E000,
     0x00080000,  0x000A0000,  0x000C0000,  0x000E0000,
     0x00800000,  0x00A00000,  0x00C00000,  0x00E00000,
     0x08000000,  0x0A000000,  0x0C000000,  0x0E000000,
     0x80000000,  0xA0000000,  0xC0000000,  0xE0000000,
    -0x00000008, -0x0000000A, -0x0000000D, -0x0000000E,
    -0x00000080, -0x000000A0, -0x000000D0, -0x000000E0,
    -0x00000800, -0x00000A00, -0x00000D00, -0x00000E00,
    -0x00008000, -0x0000A000, -0x0000D000, -0x0000E000,
    -0x00080000, -0x000A0000, -0x000D0000, -0x000E0000,
    -0x00800000, -0x00A00000, -0x00D00000, -0x00E00000,
    -0x08000000, -0x0A000000, -0x0D000000, -0x0E000000,
    -0x80000000, -0xA0000000, -0xD0000000, -0xE0000000,

     0x7FFFFFFF,  0x7FFFFFFF,  0x7FFFFFFF,  0x7FFFFFFF, // Ending Pad
     0x7FFFFFFF,  0x7FFFFFFF,  0x7FFFFFFF,  0x7FFFFFFF, // Ending Pad
     0x7FFFFFFF,  0x7FFFFFFF,  0x7FFFFFFF,  0x7FFFFFFF, // Ending Pad
     0x7FFFFFFF,  0x7FFFFFFF,  0x7FFFFFFF,  0x7FFFFFFF, // Ending Pad
};

/* ======================================================================= */
/* Prototypes for timing functions                                         */
/* ======================================================================= */
clock_t time_cn(int n);
clock_t time_i(int n);

int max_cn;
int max_i;

/* ======================================================================= */
/* MAIN -- Top level driver for testing the algorithm                      */
/* ======================================================================= */
int main()
{
    clock_t t_overhead, t_start, t_stop;
    clock_t t_cn, t_i;
    int i, n, fail = 0;

    /* =================================================================== */
    /* Compute overhead of calling clock() twice to get timing info        */
    /* =================================================================== */
    t_start = clock();
    t_stop = clock();
    t_overhead = t_stop - t_start;

    /* =================================================================== */
    /* Loop through multiple test cases to check if algorithm works for    */
    /* all valid values of N. See kernel for algorithm restrictions.       */
    /* =================================================================== */
    for (n = 8, i = 1; n <= N; n += 8, i++) {
		/* ================================================================= */
        /* Call the individual timing routines, and subtract off overhead    */
        /* ================================================================= */
        t_cn = time_cn(n) - t_overhead;    // Calculate time to run Natural C Algorithm
        t_i = time_i(n) - t_overhead;    // Calculate time to run Intrinsic C Algorithm

        /* ================================================================= */
        /* Print iteration information                                       */
        /* ================================================================= */
        printf("DSP_bexp\tIter#: %d\t", i);

        /* ================================================================= */
        /* Check the results arrays, and report any failures                 */
        /* ================================================================= */
        if (memcmp(&max_i, &max_cn, sizeof(max_cn))) {
            fail++;
            printf("Result failure (max_i)");
        }
        else
            printf("Result successful (max_i)");

        /* ================================================================= */
        /* Print timing results                                              */
        /* ================================================================= */
        printf("\tN = %d\tnatC: %d\tintC: %d\n", n, t_cn, t_i);
    }

    return(fail);
}

/* ======================================================================= */
/* Timing Functions                                                        */
/* ======================================================================= */
clock_t time_cn(int n)
{
    clock_t t_start, t_stop;

    t_start = clock();
    max_cn = DSP_bexp_cn(x + PAD, n);
    t_stop = clock();
    return t_stop - t_start;
}

clock_t time_i(int n)
{
    clock_t t_start, t_stop;

    t_start = clock();
    max_i = DSP_bexp(x + PAD, n);
    t_stop = clock();
    return t_stop - t_start;
}

/* ======================================================================= */
/*  End of file:  DSP_bexp_d.c                                             */
/* ----------------------------------------------------------------------- */
/*            Copyright (c) 2007 Texas Instruments, Incorporated.          */
/*                           All Rights Reserved.                          */
/* ======================================================================= */

